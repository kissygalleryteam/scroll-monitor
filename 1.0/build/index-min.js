/*! scroll-monitor - v1.0 - 2013-05-30 9:20:57 PM
* Copyright (c) 2013 虎牙; Licensed  */
KISSY.add("gallery/scroll-monitor/1.0/index",function(a,b,c,d){"use strict";function e(){e.superclass.constructor.apply(this,arguments),this.init.apply(this,arguments)}var f=window,g=document,h=g.body,i=g.documentElement,j=a.UA.ios,k=a.UA.webkit,l="node",m="margin",n="delay",o="run",p="destroyed",q="resize",r="scroll",s="scrollDown",t="scrollLeft",u="scrollRight",v="scrollUp",w="scrollToBottom",x="scrollToLeft",y="scrollToRight",z="scrollToTop",A="afterDelayChange",B="afterMarginChange",C="afterRunChange";return e.ATTRS={node:{setter:function(b){return b=a.get(b),(b===i||b===f)&&(b=h),a.one(b)}},delay:{value:15},margin:{value:30},run:{value:!1},destroyed:{value:!1}},a.extend(e,d,{init:function(){this._node=this.get(l),this._domNode=this._node[0],this._isBody=this._domNode===h,this._scrollNode=this._isBody?f:this._domNode,this._margin=this.get(m),this._delay=this.get(n),this.on(A,this._afterDelayChange),this.on(B,this._afterMarginChange),this.on(C,this._afterRunChange),this.get(o)&&this._runMonitor()},destroy:function(){this.stop(),this.detach(),delete this._node,delete this._domNode,delete this._isBody,delete this._scrollNode,delete this._margin,delete this._delay,delete this._lastScroll,delete this._scrollTimeout,this.set(p,!0)},checkScroll:function(){return c.fire(this._scrollNode,r),this},getScrollInfo:function(){var b=e.getScrollInfo(this._domNode,this._margin),c=this._lastScroll,d=!!c;return a.merge(b,{isScrollDown:d&&b.scrollTop>c.scrollTop,isScrollUp:d&&b.scrollTop<c.scrollTop,isScrollLeft:d&&b.scrollLeft<c.scrollLeft,isScrollRight:d&&b.scrollLeft>c.scrollLeft})},run:function(){return this.set(o,!0),this},stop:function(){return this.set(o,!1),this},_bindScroll:function(){c.on(this._scrollNode,r,this._afterScroll,this),c.on(f,q,this._afterResize,this)},_detachScroll:function(){c.detach(this._scrollNode,r,this._afterScroll,this),c.detach(f,q,this._afterResize,this)},_runMonitor:function(){this._bindScroll(),this.checkScroll()},_stopMonitor:function(){clearTimeout(this._scrollTimeout),this._lastScroll=null,this._detachScroll()},_triggerScroll:function(b){var c=this.getScrollInfo(),d=a.mix(c,{domEvent:b}),e=this._lastScroll;this._lastScroll=c,b&&(this.fire(r,d),c.isScrollLeft?this.fire(t,d):c.isScrollRight&&this.fire(u,d),c.isScrollUp?this.fire(v,d):c.isScrollDown&&this.fire(s,d)),!c.atBottom||e&&e.atBottom||this.fire(w,d),!c.atLeft||e&&e.atLeft||this.fire(x,d),!c.atRight||e&&e.atRight||this.fire(y,d),!c.atTop||e&&e.atTop||this.fire(z,d)},_afterResize:function(){this.checkScroll()},_afterScroll:function(a){var b=this;clearTimeout(this._scrollTimeout),this._scrollTimeout=setTimeout(function(){b._triggerScroll(a)},this._delay)},_afterDelayChange:function(a){this._delay=a.newVal},_afterMarginChange:function(a){this._margin=a.newVal},_afterRunChange:function(a){a.newVal?this._runMonitor():this._stopMonitor()}}),e.getScrollInfo=function(b,c){var d=a.get(b),e=d===h||d===i||d===f,g=e&&j,l=e&&!k?i:d,m=g?f:e&&k?i:l,n=g?m.innerHeight:m.clientHeight,o=g?m.innerWidth:m.clientWidth,p=l.scrollLeft,q=l.scrollHeight,r=l.scrollTop,s=l.scrollWidth,t=r+n,u=p+o;return c=c||0,{atBottom:t>=q-c,atLeft:c>=p,atRight:u>=s-c,atTop:c>=r,viewportHeight:n,viewportWidth:o,scrollable:q>n,scrollBottom:t,scrollHeight:q,scrollLeft:p,scrollRight:u,scrollTop:r,scrollWidth:s}},e},{requires:["node","event","base"]});