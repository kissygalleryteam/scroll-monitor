/*! scroll-monitor - v1.0 - 2013-05-31 6:13:55 PM
* Copyright (c) 2013 虎牙; Licensed  */
KISSY.add("gallery/scroll-monitor/1.0/index",function(a,b,c,d){"use strict";function e(){e.superclass.constructor.apply(this,arguments),this.init.apply(this,arguments)}var f=window,g=document,h=g.body,i=g.documentElement,j=a.UA.ios,k=a.UA.webkit,l="run",m="node",n="delay",o="margin",p="destroyed",q="",r=" ",s=l,t="stop",u="resize",v="scroll",w="scrollDown",x="scrollLeft",y="scrollRight",z="scrollUp",A="scrollToBottom",B="scrollToLeft",C="scrollToRight",D="scrollToTop",E="afterDelayChange",F="afterMarginChange",G="afterRunChange";return e.ATTRS={node:{setter:function(b){return b=a.get(b),(b===i||b===f)&&(b=h),a.one(b)}},delay:{value:15},margin:{value:30},run:{value:!1},destroyed:{value:!1}},a.extend(e,d,{init:function(){this._node=this.get(m),this._domNode=this._node[0],this._isBody=this._domNode===h,this._scrollNode=this._isBody?f:this._domNode,this._delay=this.get(n),this._margin=this.get(o),this.publish(s,{defaultFn:a.bind(this._defRunFn,this)}),this.publish(t,{defaultFn:a.bind(this._defStopFn,this)}),this.on(E,this._afterDelayChange),this.on(F,this._afterMarginChange),this.on(G,this._afterRunChange),this.get(l)&&this.fire(s)},destroy:function(){this.stop(),this.detach(),delete this._node,delete this._domNode,delete this._isBody,delete this._scrollNode,delete this._margin,delete this._delay,delete this._lastScroll,delete this._scrollTimeout,this.set(p,!0)},checkScroll:function(a){return a!==!1&&(this._lastScroll=null),c.fire(this._scrollNode,v),this},getScrollInfo:function(){var b=e.getScrollInfo(this._domNode,this._margin),c=this._lastScroll,d=!!c;return a.merge(b,{isScrollDown:d&&b.scrollTop>c.scrollTop,isScrollUp:d&&b.scrollTop<c.scrollTop,isScrollLeft:d&&b.scrollLeft<c.scrollLeft,isScrollRight:d&&b.scrollLeft>c.scrollLeft})},run:function(){return this.set(l,!0),this},stop:function(){return this.set(l,!1),this},_bindScroll:function(){c.on(this._scrollNode,v,this._afterScroll,this),c.on(f,u,this._afterResize,this)},_detachScroll:function(){c.detach(this._scrollNode,v,this._afterScroll,this),c.detach(f,u,this._afterResize,this)},_refreshMargin:function(){var a=this.get(o)+"",b=a.split(" ");switch(this._marginTop=Number(b[0]),this._marginRight=Number(b[1]),this._marginBottom=Number(b[2]),this._marginLeft=Number(b[3]),b.length){case 1:this._marginRight=this._marginBottom=this._marginLeft=this._marginTop;break;case 2:this._marginBottom=this._marginTop,this._marginLeft=this._marginRight;break;case 3:this._marginLeft=this._marginRight}},_runMonitor:function(){this._bindScroll(),this.checkScroll()},_stopMonitor:function(){clearTimeout(this._scrollTimeout),this._lastScroll=null,this._detachScroll()},_triggerScroll:function(b){var c=this.getScrollInfo(),d=a.mix(c,{domEvent:b}),e=this._lastScroll;this._lastScroll=c,b&&(this.fire(v,d),c.isScrollLeft?this.fire(x,d):c.isScrollRight&&this.fire(y,d),c.isScrollUp?this.fire(z,d):c.isScrollDown&&this.fire(w,d)),!c.atBottom||e&&e.atBottom||this.fire(A,d),!c.atLeft||e&&e.atLeft||this.fire(B,d),!c.atRight||e&&e.atRight||this.fire(C,d),!c.atTop||e&&e.atTop||this.fire(D,d)},_defRunFn:function(){this._runMonitor()},_defStopFn:function(){this._stopMonitor()},_afterResize:function(){this.checkScroll(!1)},_afterScroll:function(a){var b=this;clearTimeout(this._scrollTimeout),this._scrollTimeout=setTimeout(function(){b._triggerScroll(a)},this._delay)},_afterDelayChange:function(a){this._delay=a.newVal},_afterMarginChange:function(a){this._margin=a.newVal},_afterRunChange:function(a){a.newVal?this.fire(s):this.fire(t)}}),e.getScrollInfo=function(b,c){var d=a.get(b),e=d===h||d===i||d===f,g=e&&j,l=e&&!k?i:d,m=g?f:e&&k?i:l,n=g?m.innerHeight:m.clientHeight,o=g?m.innerWidth:m.clientWidth,p=l.scrollLeft,s=l.scrollHeight,t=l.scrollTop,u=l.scrollWidth,v=t+n,w=p+o,x=((c||0)+q).split(r),y=Number(x[0]),z=Number(x[1]),A=Number(x[2]),B=Number(x[3]);switch(x.length){case 1:z=A=B=y;break;case 2:A=y,B=z;break;case 3:B=z}return{atBottom:v>=s-A,atLeft:B>=p,atRight:w>=u-z,atTop:y>=t,viewportHeight:n,viewportWidth:o,scrollable:s>n,scrollBottom:v,scrollHeight:s,scrollLeft:p,scrollRight:w,scrollTop:t,scrollWidth:u}},e},{requires:["node","event","base"]});